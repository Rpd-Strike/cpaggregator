{% extends "layout.html" %}

{% load render_table from django_tables2 %}
{% load bootstrap4 %}
{% load static from staticfiles %}
{% load mathfilters %}

{% block title_tag %}Dashboard{% endblock %}

{% block body_content %}
{% with request.user as user %}
<div class="container">
    <h1 class="mt-5">Dashboard</h1>


    <h5 class="mb-3 mt-5">Newly added tasks</h5>
    <div class="list-group">
        {% include 'info/task/task_list_group.html' with task_list=newly_added_task_list %}
    </div>
    {% if popular_group_list|length > 0 %}
    <h5 class="mb-3 mt-5">Popular groups</h5>
     <div class="row">
        {% for group_data in popular_group_list %}
            <div class="col-12 col-lg-4 px-2 mb-3">
             {% include 'info/group/group_card.html' %}
         </div>
        {% endfor %}
    </div>
    <a class='btn btn-link btn-sm float-right' href="{% url 'group-list' %}">See all</a>
    {% endif %}

    {% if owned_groups_data|length > 0 %}
    <h5 class="mb-3 mt-5">Groups you manage</h5>
     <div class="row">
        {% for group_data in owned_groups_data %}
         <div class="col-12 col-lg-4 px-2 mb-2">
             {% include 'info/group/group_card.html' %}
         </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if assigned_groups_data|length > 0 %}
    <h5 class="mb-3 mt-5">Assigned to you</h5>
     <div class="row">
        {% for group_data in assigned_groups_data %}
         <div class="col-12 col-lg-4 px-2 mb-3">
             {% include 'info/group/group_card.html' %}
         </div>
         {% empty %}
         <p class="mx-3">You are not a member of any groups yet.</p>
        {% endfor %}
    </div>
    {% endif %}

    {% if 0 %}
    <h5 class="mb-3 mt-5">Your task sheets</h5>
    <div class="card mb-5">
        <h6 class="card-header">Your task sheets</h6>
        <div class="list-group list-group-flush">
            {% for sheet_data in sheets %}
            {% with task_sheet=sheet_data.sheet solved_count=sheet_data.solved_count %}
            <a class="list-group-item list-group-item-action"
               href="{% url 'sheet-detail' sheet_id=task_sheet.sheet_id %}">
                <div class="d-flex align-items-center">
                    <span class="flex-grow-1">
                        <strong class="mr-2">
                            {{ task_sheet.title }}
                        </strong>
                        {% if solved_count == task_sheet.tasks.all|length %}
                        <span class="badge badge-pill badge-success">
                        {% else %}
                        <span class="badge badge-pill badge-secondary">
                        {% endif %}
                            {{ solved_count }}/{{ task_sheet.tasks.all|length }} solved
                        </span>
                    </span>
                    <span class="small text-muted">
                        {{ task_sheet.created_at|date:"M d Y" }}
                    </span>
                    </span>
                </div>
            </a>
            {% endwith %}
            {% endfor %}
        </div>
        <div class="card-footer">
            <span class="small text-muted">
                {% if sheets|length <= 0 %}
                No task sheets.
                {% else %}
                {{ sheets|length }} task sheet{{ sheets|length|pluralize }}
                {% endif %}
            </span>
        </div>
    </div>
    {% endif %}
</div>
{% endwith %}
{% endblock %}